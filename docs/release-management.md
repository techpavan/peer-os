# Release Management

By moving to Gradle, we have taken the step to make proper releases, and not the
messed up dev/master/stage/? branches where source is pushed straight into the
execution environment.

A RELEASE is one or more immutable artifacts that is built and strongly associated with a 
corresponding TAG in source control. The built artifacts are uploaded to a REPOSITORY
(Sonatype's Nexus in our case), and Team Infra will take it from there.

Our open source friends at Netflix have created a few really good Gradle plugins to
handle all the bits for us.

1. Build numbers are incremented automatically.
2. Allows for uncommitted releases for testing purposes.
3. Handles the tagging of Git repository
4. World Peace.


## Full Release
A full release will be uploaded to Nexus and kept forever.

The version is set to the appropriate `<major>.<minor>.<patch>`, creates 
tag `v<major>.<minor>.<patch>`

```./gradlew final```

A Full Release will ONLY be allowed once the QA Team has performed the FULL 
Acceptance Test Suite, without P0-P2 (Priority 0 to Priority 2) breakage.

Full releases are executed by Jenkins job and only initiated by Release Manager.

## Release Candidate
Release Candidates are official releases, kept forever that are required to go
through a full Accept Test cycle, incl both automated and manual test protocols.

A Full Release will only be allowed once the QA Team has performed the Acceptance
Test suite, without P0-P2 (Priority 0 to Priority 2) breakage.

```./gradlew candidate```

Release of Candidates are executed by Jenkins job and only initiated by Release 
Manager.

## Nightly Release
Every night Jenkins will build a so called nightly release, which is suitable for;

1. QA to run automated acceptance tests against latest head development

1. Development teams where cross-repository dependencies are necessary.

Nightly releases are only kept for 7 days.

A nightly release is generated by executing

```./gradlew snapshot```

The version will be set to the appropriate `<major>.<minor>.<patch>-SNAPSHOT`, 
and does not create a tag. `SNAPSHOT` will both be a timestamp and the word `SNAPSHOT`
will be linked to the latest timestamp in the repository (or locally on disk).

## Development Release

A development release can be made at any time from command-line. These are
for temporary use only, typically when cross-project collaboration is required.
They may disappear at any time.
 
The version will be set to the appropriate `<major>.<minor>.<patch>-dev.#+<hash>`, 
and does not create a tag in Git. `#` is the number of commits since the last release 
and `hash` is the git hash of the current commit. If releasing a `devSnapshot` from 
a branch not listed in the `releaseBranchPatterns` and not excluded by 
`excludeBranchPatterns` the version will be 
`<major>.<minor>.<patch>-dev.#+<branchname>.<hash>`

```./gradlew devSnapshot```


## Bumping versions

* bump the major number: 

```./gradlew <snapshot|devSnapshot|candidate|final> -Prelease.scope=major```

* bump the patch number: 

```./gradlew <snapshot|devSnapshot|candidate|final> -Prelease.scope=patch```

